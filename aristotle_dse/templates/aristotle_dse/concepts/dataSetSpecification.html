{% extends "aristotle_mdr/concepts/managedContent.html" %}

{% load aristotle_tags %}

{% block objSpecific %}
<h2>Metadata items in this Data Set Specification</h2>
    <p> Below is a list of all the components within this Dataset Specification.
        <br> Each entry includes the item name, whether the item is <em>optional, mandatory or conditional</em> and the maximum times the item can occur in a dataset.
        <br> If the items must occur in a particular order in the dataset, the sequence number is included before the item name.
    </p>
    {% if item|can_edit:request.user %}
        <a href="{% url 'aristotle_dse:addDataElementsToDSS' dss_id=item.id %}"
            data-toggle="modal" data-target="#addDEtoDSS"
            class="btn btn-primary">
            <i class="fa fa-plus"></i>
            Add a data element to this data set specification
        </a>
        {% bootstrap_modal 'addDEtoDSS' %}
        
    {% endif %}
    <script>
        $(function () {
          $('[data-toggle="popover"]').popover()
        })
    </script>

    {% if item.dataelement_set.exists or item.cluster_set.exists %}
        <table class="dssInclusions table table-striped table-condensed">
            <thead>
                <tr>
                    <th></th>
                    <th>Data Element</th>
                    <th>
                        <a tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-placement="left" data-html="true"
                            title="Data Element Inclusion" data-content="The rules for inclusion for a data element within a data set.<br>May be optional, mandatory or conditional">
                            Inclusion</a>
                    </th>
                    <th class="maxOccurs">
                        <a tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-placement="left"
                            title="Maximum Occurances" data-content="The maximum number of times a data element may be repeated in a data set.">
                            #</a>
                    </th>
                    {% if item|can_edit:request.user %}<th title="Use the links in this column to remove data elements from this Dataset specification"><i class="fa fa-trash-o"></i></th>{% endif %}
                </tr>
            </thead>
            {% if item.cluster_set.exists %}
            <tbody>
            {% for deinc in item.cluster_set.all %}
                <tr>
                    <td></td>
                    <td>{% include "aristotle_mdr/helpers/itemLink.html" with item=deinc.dataElement %}
                        {% if deinc.specificInformation %}
                        <div>
                            {{ deinc.specificInformation | safe }}
                        </div>
                        {% endif %}
                        {% if deinc.conditionalObligation %}
                        <div>
                            <strong>Conditional Obligation:</strong>{{ deinc.conditionalObligation }}
                        </div>
                        {% endif %}
                    </td>
                    <td>{{ deinc.cardinality }}</td>
                    <td>{{ deinc.maximumOccurances }}</td>
                    {% if item|can_edit:request.user %}
                    <td>
                        <a href="{% url 'aristotle_dse:removeClusterFromDSS' deinc.child.id item.id %}"
                        class="close" title="Remove from Dataset specification">
                            <i class="fa fa-times"></i>
                        </a>
                    </td>
                    {% endif %}
                </tr>
            {% endfor %}
            </tbody>
            {% endif %}
            {% if item.dataelement_set.exists %}
            <tbody>
            {% for deinc in item.dataelement_set.all %}
                <tr>
                    <td></td>
                    <td>{% include "aristotle_mdr/helpers/itemLink.html" with item=deinc.dataElement %}
                        {% if deinc.specificInformation %}
                        <div>
                            {{ deinc.specificInformation | safe }}
                        </div>
                        {% endif %}
                        {% if deinc.conditionalObligation %}
                        <div>
                            <strong>Conditional Obligation:</strong>{{ deinc.conditionalObligation }}
                        </div>
                        {% endif %}
                    </td>
                    <td>{{ deinc.cardinality }}</td>
                    <td>{{ deinc.maximumOccurances }}</td>
                    {% if item|can_edit:request.user %}
                    <td>
                        <a href="{% url 'aristotle_dse:removeDataElementFromDSS' deinc.dataElement.id item.id %}"
                        class="close" title="Remove from Dataset specification">
                            <i class="fa fa-times"></i>
                        </a>
                    </td>
                    {% endif %}
                </tr>
            {% endfor %}
            </tbody>
            {% endif %}
            <tfoot>
                <tr>
                    <th></th>
                    <th>Data Element</th>
                    <th>Inclusion</th>
                    <th title="Maximum Occurances">#</th>
                    {% if item|can_edit:request.user %}<th><i class="fa fa-trash-o"></i></th>{% endif %}
                </tr>
            </tfoot>
        </table>
    {% else %}
    <div class="well well-lg">No data elements have been assigned to this data set specification.</div>
    {% endif %}

{% endblock %}
